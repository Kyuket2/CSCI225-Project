<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/menu.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
    <title>Breaktime Blues</title>
</head>

<body>

    <div id="gametittle">
        <img src="sprites/menu/menu_title.png" alt="Breaktime Blues Title" width="600" height="300">
    </div>

    <div class="container">

        <div id="startbutton" class="sbuttons">
            <img src="sprites/menu/menu_start_button.png" alt="Start Button" width="200" height="200">
        </div>

        <div id="rules" class="sbuttons">
            <img src="sprites/menu/menu_instructions_button.png" alt="Instructions Button" width="100" height="100">
        </div>

        <div id="leaderboard" class="sbuttons">
            <img src="sprites/menu/menu_leaderboards_button.png" alt="Leaderboards Button" width="100" height="100">
        </div>

        <div id="credits" class="sbuttons">
            <img src="sprites/menu/menu_credits_button.png" alt="Credits Button" width="100" height="100">
        </div>

        <div id="instruct">
            <h1>Welcome to</h1>
            <img src="sprites/menu/menu_title_words.png" alt="Title" width="400" height="200">
            <p>Oh, no!</p>
            <p>Your break is here, and you only have five minutes to go grab a coffee!</p>
            <p>But, oh, no! You aren't allowed to leave your office without these things:</p>
            <img src="sprites/items/idcard.png" alt="employee key card">
            <img src="sprites/items/paper/form_complete.png" alt="signed permission form">
            <img src="sprites/items/keys.png" alt="set of keys">
            <p>And, of course, the 4-digit code for the door!</p>
            <p>Surely you'll find them around your office if you CLICK, DRAG, & COMBINE enough.</p>
            <p>Click and middle click to interact with any given item.</p>
            <p>But hurry up! You have to get a coffee before your 5-minute break is over, so good luck!</p>
            <p><br><br><br>But hold on! You also left some coins around your office, and an extra bag of chips wouldn't
                hurt to grab. Pick those up for extra points!</p>
            <p>Ready? Click the "Start!" button to begin!</p>
        </div>

        <div id="leaderboardRanking">
            <h1>Leaderboards: </h1>
            <p>1. GRG - 0000</p>
            <p>2. JNC - 0000</p>
            <p>3. MTV - 0000</p>
            <p>4. YLZ - 0000</p>
            <p>5. KRS - 0000</p>
            <p>6. GUD - 0000</p>
            <p>7. TRN - 0000</p>
            <p>8. MID - 0000</p>
            <p>9. TST - 0000</p>
            <p>10. SUS - 0000</p>
            <p>11. BAD - 0000</p>
            <p>12. RAL - 0000</p>
        </div>

        <div id="credtext">
            <h1>Team Paperwave:</h1>
            <p>John Clegg - Lead Programmer and Developer</p>
            <p>Matthew Voyles - Lead Artist and Designer, Assistant Programmer, Lead Presenter</p>
        </div>

    </div>

    <script>
        const begin = document.getElementById('startbutton');
        begin.addEventListener('click', () => { window.location.href = 'main.html'; });
    </script>


    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            query,
            orderBy,
            limit,
            getDocs
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

        // Config
        const firebaseConfig = {
            apiKey: "AIzaSyC7R0FRTBdMhOY6cwOSrC9hcyHu1tdES5w",
            authDomain: "database2025-471bf.firebaseapp.com",
            projectId: "database2025-471bf",
            storageBucket: "database2025-471bf.firebasestorage.app",
            messagingSenderId: "944224648775",
            appId: "1:944224648775:web:0a156918478534baffbb62",
            measurementId: "G-BBRFEXS6NE"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadLeaderboard() {
            const lbDiv = document.getElementById("leaderboardRanking");
            if (!lbDiv) return;

            // Query top 12 scores, the highest will be first of course
            const q = query(
                collection(db, "scores"),
                orderBy("score", "desc"),
                limit(12)
            );

            let html = "<h1>Leaderboards:</h1>";

            // Apply ranking
            try {
                const snap = await getDocs(q);
                let rank = 1;

                snap.forEach(doc => {
                    const data = doc.data();
                    const initials = (data.initials || "???").toString().toUpperCase();
                    const score = String(data.score || 0).padStart(4, "0");

                    html += `<p>${rank}. ${initials} - ${score}</p>`;
                    rank++;
                });

                // If there are fewer than 12 scores, pad with blanks
                while (rank <= 12) {
                    html += `<p>${rank}. --- - 0000</p>`;
                    rank++;
                }

                lbDiv.innerHTML = html;
            } catch (err) {
                console.error("Error loading leaderboard:", err);
                lbDiv.innerHTML = "<h1>Leaderboards:</h1><p>Unable to load scores.</p>";
            }
        }

        loadLeaderboard();
    </script>


</body>

</html>